<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Schema Migration Report</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<style>
    body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        margin: 0;
        padding: 20px;
        background-color: #f5f5f5;
        color: #333;
    }

    .header {
        padding: 20px;
        text-align: center;
        background: linear-gradient(135deg, #1abc9c, #16a085);
        color: white;
        font-size: 24px;
        margin-bottom: 30px;
        border-radius: 8px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    .header h1 {
        margin: 0;
        font-weight: 300;
    }

    .summary-cards {
        display: flex;
        flex-wrap: wrap;
        gap: 20px;
        margin-bottom: 30px;
        justify-content: center;
    }

    .card {
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        text-align: center;
        min-width: 150px;
        flex: 1;
        max-width: 200px;
    }

    .card-title {
        font-size: 14px;
        color: #666;
        margin-bottom: 10px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .card-value {
        font-size: 32px;
        font-weight: bold;
        color: #1abc9c;
        margin-bottom: 5px;
    }

    .card-subtitle {
        font-size: 12px;
        color: #999;
    }

    .success-rate {
        color: #27ae60;
    }

    .error-rate {
        color: #e74c3c;
    }

    table {
        border-collapse: collapse;
        margin: 20px auto;
        background: white;
        border-radius: 8px;
        overflow: hidden;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        width: 95%;
        max-width: 1200px;
    }

    thead {
        background: linear-gradient(135deg, #34495e, #2c3e50);
        color: white;
    }

    th {
        padding: 15px 12px;
        text-align: left;
        font-weight: 500;
        border-bottom: none;
    }

    td {
        padding: 12px;
        text-align: left;
        border-bottom: 1px solid #ecf0f1;
        background-color: white;
    }

    tr:nth-child(even) td {
        background-color: #f8f9fa;
    }

    tr:hover td {
        background-color: #e8f5e8;
    }

    .status-success {
        color: #27ae60;
        font-weight: bold;
    }

    .status-error {
        color: #e74c3c;
        font-weight: bold;
    }

    .section-title {
        background: linear-gradient(135deg, #3498db, #2980b9);
        color: white;
        text-align: center;
        font-size: 18px;
        font-weight: 500;
    }

    @media (max-width: 768px) {
        .summary-cards {
            flex-direction: column;
        }

        table {
            font-size: 14px;
        }

        th, td {
            padding: 8px;
        }
    }
</style>
<body>
<div class="header">
    <h1>Solr to OpenSearch Schema Migration Report</h1>
    <p style="margin: 10px 0 0 0; font-size: 14px; opacity: 0.9;">Generated on {{ timestamp }}</p>
</div>
<div class="summary-cards">
    <div class="card">
        <div class="card-title">Field Types</div>
        <div class="card-value">{{ summary.field_types.total }}</div>
        <div class="card-subtitle">
            <span class="success-rate">{{ summary.field_types.mapped }} mapped</span> •
            <span class="error-rate">{{ summary.field_types.error }} errors</span>
        </div>
    </div>
    <div class="card">
        <div class="card-title">Fields</div>
        <div class="card-value">{{ summary.fields.total }}</div>
        <div class="card-subtitle">
            <span class="success-rate">{{ summary.fields.mapped }} mapped</span> •
            <span class="error-rate">{{ summary.fields.error }} errors</span>
        </div>
    </div>
    <div class="card">
        <div class="card-title">Dynamic Fields</div>
        <div class="card-value">{{ summary.dynamic_fields.total }}</div>
        <div class="card-subtitle">
            <span class="success-rate">{{ summary.dynamic_fields.mapped }} mapped</span> •
            <span class="error-rate">{{ summary.dynamic_fields.error }} errors</span>
        </div>
    </div>
    <div class="card">
        <div class="card-title">Copy Fields</div>
        <div class="card-value">{{ summary.copy_fields.total }}</div>
        <div class="card-subtitle">
            <span class="success-rate">{{ summary.copy_fields.mapped }} mapped</span> •
            <span class="error-rate">{{ summary.copy_fields.error }} errors</span>
        </div>
    </div>
</div>

<!-- Text Analysis Summary Cards -->
{% if text_analysis.tokenizers.total > 0 or text_analysis.filters.total > 0 or text_analysis.char_filters.total > 0 %}

    <div class="summary-cards">
        {% if text_analysis.tokenizers.total > 0 %}
            <div class="card">
                <div class="card-title">Tokenizers</div>
                <div class="card-value">{{ text_analysis.tokenizers.total }}</div>
                <div class="card-subtitle">
                    <span class="success-rate">{{ text_analysis.tokenizers.successful }} successful</span> •
                    <span class="error-rate">{{ text_analysis.tokenizers.failed }} failed</span>
                </div>
            </div>
        {% endif %}
        {% if text_analysis.filters.total > 0 %}
            <div class="card">
                <div class="card-title">Filters</div>
                <div class="card-value">{{ text_analysis.filters.total }}</div>
                <div class="card-subtitle">
                    <span class="success-rate">{{ text_analysis.filters.successful }} successful</span> •
                    <span class="error-rate">{{ text_analysis.filters.failed }} failed</span>
                </div>
            </div>
        {% endif %}
        {% if text_analysis.char_filters.total > 0 %}
            <div class="card">
                <div class="card-title">Char Filters</div>
                <div class="card-value">{{ text_analysis.char_filters.total }}</div>
                <div class="card-subtitle">
                    <span class="success-rate">{{ text_analysis.char_filters.successful }} successful</span> •
                    <span class="error-rate">{{ text_analysis.char_filters.failed }} failed</span>
                </div>
            </div>
        {% endif %}
    </div>
{% endif %}

<table>
    <thead>
    <tr>
        <th colspan="5" class="section-title">Migration Summary</th>
    </tr>
    </thead>
    <tr>
        <th>Component Type</th>
        <th>Total Found</th>
        <th>Successfully Mapped</th>
        <th>Errors</th>
        <th>Success Rate</th>
    </tr>
    <tr>
        <td>Field Types</td>
        <td>{{ summary.field_types.total }}</td>
        <td class="status-success">{{ summary.field_types.mapped }}</td>
        <td class="status-error">{{ summary.field_types.error }}</td>
        <td>{% if summary.field_types.total > 0 %}
            {{ ((summary.field_types.mapped / summary.field_types.total) * 100)|round(1) }}%{% else %}
            N/A{% endif %}</td>
    </tr>
    <tr>
        <td>Fields</td>
        <td>{{ summary.fields.total }}</td>
        <td class="status-success">{{ summary.fields.mapped }}</td>
        <td class="status-error">{{ summary.fields.error }}</td>
        <td>{% if summary.fields.total > 0 %}{{ ((summary.fields.mapped / summary.fields.total) * 100)|round(1) }}
            %{% else %}N/A{% endif %}</td>
    </tr>
    <tr>
        <td>Dynamic Fields</td>
        <td>{{ summary.dynamic_fields.total }}</td>
        <td class="status-success">{{ summary.dynamic_fields.mapped }}</td>
        <td class="status-error">{{ summary.dynamic_fields.error }}</td>
        <td>{% if summary.dynamic_fields.total > 0 %}
            {{ ((summary.dynamic_fields.mapped / summary.dynamic_fields.total) * 100)|round(1) }}%{% else %}
            N/A{% endif %}</td>
    </tr>
    <tr>
        <td>Copy Fields</td>
        <td>{{ summary.copy_fields.total }}</td>
        <td class="status-success">{{ summary.copy_fields.mapped }}</td>
        <td class="status-error">{{ summary.copy_fields.error }}</td>
        <td>{% if summary.copy_fields.total > 0 %}
            {{ ((summary.copy_fields.mapped / summary.copy_fields.total) * 100)|round(1) }}%{% else %}
            N/A{% endif %}</td>
    </tr>
</table>

<!-- Text Analysis Error Details -->
{% if text_analysis.tokenizers.failed_list %}
    <table>
        <thead>
        <tr>
            <th colspan="3" class="section-title">Tokenizer Mapping Error Details</th>
        </tr>
        </thead>
        <tr>
            <th>Tokenizer Name</th>
            <th>Tokenizer Type</th>
            <th>Error Details</th>
        </tr>
        {% for tokenizer_error in text_analysis.tokenizers.failed_list %}
            <tr>
                <td>{{ tokenizer_error.name }}</td>
                <td>{{ tokenizer_error.type }}</td>
                <td>{{ tokenizer_error.error }}</td>
            </tr>
        {% endfor %}
    </table>
{% endif %}

{% if text_analysis.filters.failed_list %}
    <table>
        <thead>
        <tr>
            <th colspan="3" class="section-title">Filter Mapping Error Details</th>
        </tr>
        </thead>
        <tr>
            <th>Filter Name</th>
            <th>Filter Type</th>
            <th>Error Details</th>
        </tr>
        {% for filter_error in text_analysis.filters.failed_list %}
            <tr>
                <td>{{ filter_error.name }}</td>
                <td>{{ filter_error.type }}</td>
                <td>{{ filter_error.error }}</td>
            </tr>
        {% endfor %}
    </table>
{% endif %}

{% if text_analysis.char_filters.failed_list %}
    <table>
        <thead>
        <tr>
            <th colspan="3" class="section-title">CharFilter Mapping Error Details</th>
        </tr>
        </thead>
        <tr>
            <th>CharFilter Name</th>
            <th>CharFilter Type</th>
            <th>Error Details</th>
        </tr>
        {% for char_filter_error in text_analysis.char_filters.failed_list %}
            <tr>
                <td>{{ char_filter_error.name }}</td>
                <td>{{ char_filter_error.type }}</td>
                <td>{{ char_filter_error.error }}</td>
            </tr>
        {% endfor %}
    </table>
{% endif %}

<!-- Text Analysis Details Tables -->
{% if text_analysis.tokenizers.failed > 0 %}
    <table>
        <thead>
        <tr>
            <th colspan="4" class="section-title">Tokenizer Mapping Error Details</th>
        </tr>
        </thead>
        <tr>
            <th>Name</th>
            <th>Solr Type</th>
            <th>OpenSearch Type</th>
            <th>Error</th>
        </tr>
        {% for tokenizer in text_analysis.tokenizers.details %}
            {% if tokenizer.status == 'error' %}
                <tr>
                    <td>{{ tokenizer.name }}</td>
                    <td>{{ tokenizer.solr_type }}</td>
                    <td>{{ tokenizer.opensearch_type }}</td>
                    <td>{{ tokenizer.error or 'N/A' }}</td>
                </tr>
            {% endif %}
        {% endfor %}
    </table>
{% endif %}

{% if text_analysis.filters.failed > 0 %}
    <table>
        <thead>
        <tr>
            <th colspan="4" class="section-title">Filter Mapping Error Details</th>
        </tr>
        </thead>
        <tr>
            <th>Name</th>
            <th>Solr Type</th>
            <th>OpenSearch Type</th>
            <th>Error</th>
        </tr>
        {% for filter in text_analysis.filters.details %}
            {% if filter.status == 'error' %}
                <tr>
                    <td>{{ filter.name }}</td>
                    <td>{{ filter.solr_type }}</td>
                    <td>{{ filter.opensearch_type }}</td>
                    <td>{{ filter.error or 'N/A' }}</td>
                </tr>
            {% endif %}
        {% endfor %}
    </table>
{% endif %}

{% if text_analysis.char_filters.failed > 0 %}
    <table>
        <thead>
        <tr>
            <th colspan="4" class="section-title">Character Filter Mapping Error Details</th>
        </tr>
        </thead>
        <tr>
            <th>Name</th>
            <th>Solr Type</th>
            <th>OpenSearch Type</th>
            <th>Error</th>
        </tr>
        {% for char_filter in text_analysis.char_filters.details %}
            {% if char_filter.status == 'error' %}
                <tr>
                    <td>{{ char_filter.name }}</td>
                    <td>{{ char_filter.solr_type }}</td>
                    <td>{{ char_filter.opensearch_type }}</td>
                    <td>{{ char_filter.error or 'N/A' }}</td>
                </tr>
            {% endif %}
        {% endfor %}
    </table>
{% endif %}

{% if summary.field_types.exception_list %}
    <table class="field_types_results">
        <thead>
        <tr>
            <th colspan="4" class="section-title">Field Type Mapping Errors</th>
        </tr>
        </thead>
        <tr>
            <th>Field Type Name</th>
            <th>Analyzer Type</th>
            <th>Failed Component</th>
            <th>Error Details</th>
        </tr>
        {% for field_type_exception in summary.field_types.exception_list %}
            {% if field_type_exception.analyzer_exception.tokenizer_exception != None %}
                <tr>
                    <td>{{ field_type_exception.name }}</td>
                    <td>{{ field_type_exception.analyzer_exception.name or 'analyzer' }}</td>
                    <td>Tokenizer: {{ field_type_exception.analyzer_exception.tokenizer_exception.name }}</td>
                    <td>{{ field_type_exception.analyzer_exception.tokenizer_exception }}</td>
                </tr>
            {% endif %}
            {% if field_type_exception.analyzer_exception.filter_exception != None %}
                <tr>
                    <td>{{ field_type_exception.name }}</td>
                    <td>{{ field_type_exception.analyzer_exception.name or 'analyzer' }}</td>
                    <td>Filter: {{ field_type_exception.analyzer_exception.filter_exception.name }}</td>
                    <td>{{ field_type_exception.analyzer_exception.filter_exception }}</td>
                </tr>
            {% endif %}
            {% if field_type_exception.analyzer_exception.char_filter_exception != None %}
                <tr>
                    <td>{{ field_type_exception.name }}</td>
                    <td>{{ field_type_exception.analyzer_exception.name or 'analyzer' }}</td>
                    <td>CharFilter: {{ field_type_exception.analyzer_exception.char_filter_exception.name }}</td>
                    <td>{{ field_type_exception.analyzer_exception.char_filter_exception }}</td>
                </tr>
            {% endif %}
        {% endfor %}
    </table>
{% endif %}

{% if summary.fields.exception_list %}
    <table class="fields_results">
        <thead>
        <tr>
            <th colspan="3" class="section-title">Field Mapping Errors</th>
        </tr>
        </thead>
        <tr>
            <th>FieldName</th>
            <th>FieldTypeName</th>
            <th>Reason</th>
        </tr>
        {% for field_exception in summary.fields.exception_list %}
            <tr>
                <td>{{ field_exception.name }}</td>
                <td>{{ field_exception.field_type }}</td>
                <td>{{ field_exception }}</td>
            </tr>
        {% endfor %}
    </table>
{% endif %}

{% if summary.dynamic_fields.exception_list %}
    <table>
        <thead>
        <tr>
            <th colspan="3" class="section-title">Dynamic Field Mapping Errors</th>
        </tr>
        </thead>
        <tr>
            <th>DynamicFieldName</th>
            <th>FieldTypeName</th>
            <th>Reason</th>
        </tr>
        {% for dynamic_field_exception in summary.dynamic_fields.exception_list %}
            <tr>
                <td>{{ dynamic_field_exception.name }}</td>
                <td>{{ dynamic_field_exception.field_type }}</td>
                <td>{{ dynamic_field_exception }}</td>
            </tr>
        {% endfor %}
    </table>
{% endif %}

{% if summary.copy_fields.exception_list %}
    <table>
        <thead>
        <tr>
            <th colspan="3" class="section-title">Copy Field Mapping Errors</th>
        </tr>
        </thead>
        <tr>
            <th>CopyFieldName</th>
            <th>CopyFieldDstName</th>
            <th>Reason</th>
        </tr>
        {% for copy_field_exception in summary.copy_fields.exception_list %}
            <tr>
                <td>{{ copy_field_exception.name }}</td>
                <td>{{ copy_field_exception.dst_field }}</td>
                <td>{{ copy_field_exception }}</td>
            </tr>
        {% endfor %}
    </table>
{% endif %}



{% if not (summary.field_types.exception_list or summary.fields.exception_list or summary.dynamic_fields.exception_list or summary.copy_fields.exception_list) %}
    <div style="text-align: center; padding: 40px; background: white; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); margin: 20px auto; max-width: 600px;">
        <h2 style="color: #27ae60; margin-bottom: 10px;"> Migration Completed Successfully!</h2>
        <p style="color: #666; font-size: 16px;">All schema components were successfully migrated without errors.</p>
    </div>
{% endif %}
</body>
</html>